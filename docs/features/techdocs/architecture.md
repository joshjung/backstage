---
id: architecture
title: TechDocs Architecture
description: Documentation on TechDocs Architecture
---

## Basic (out-of-the-box)

When you deploy Backstage with TechDocs enabled by default, you get a basic documentation experience.

<!-- todo: Needs zoomable plugin -->

![TechDocs Architecture diagram](../../assets/techdocs/architecture-basic.drawio.svg)

:::note Note

See below for our recommended deployment architecture which takes care of stability, scalability and speed. Also look
at the [HOW TO migrate guide](how-to-guides.md#how-to-migrate-from-techdocs-basic-to-recommended-deployment-approach).

:::

When you open a TechDocs page in Backstage, the [TechDocs Reader](./concepts.md#techdocs-reader) makes a request to `techdocs-backend` plugin
with the entity ID and the path of the current page you are looking at. In response, it receives the static files
(HTML, CSS, JSON, etc.) to render the page in Backstage.

The static files consist of HTML, CSS and Images generated by MkDocs. We remove all the JavaScript before adding them
to Backstage for security reasons. And there is an additional `techdocs_metadata.json` file that TechDocs needs to
render a site. It's important that you use either [techdocs-cli](https://github.com/backstage/techdocs-cli) or
[techdocs-container](https://github.com/backstage/techdocs-container) to generate the docs for the expected output.

The TechDocs Reader then applies a list of "Transformers" (see [Concepts](./concepts.md)) which modify the generated
static HTML files for a number of use cases e.g. Remove certain headers, filter out some HTML tags, etc.

Currently, we use the Backstage server's (or techdocs-backend's) local file system to store the generated files.
However, it's ideal to use an external storage system (e.g. AWS S3, GCS or Azure Blob Storage). Read more in
[using cloud storage](using-cloud-storage.md).

## Recommended deployment

This is how we recommend deploying TechDocs in a production environment:

<!-- todo: Needs zoomable plugin -->

![TechDocs Architecture diagram](../../assets/techdocs/architecture-recommended.drawio.svg)

The key difference in the recommended deployment approach is where the docs are built.

We assume each entity lives in a repository somewhere (GitHub, GitLab, etc.). We recommend [using a CI/CD pipeline](configuring-ci-cd.md)
with the repository that has a dedicated step/job to generate docs for TechDocs. The generated static files are then
[stored in a cloud storage](using-cloud-storage.md) solution of your choice.

Similar to how it is done in the Basic setup, the TechDocs Reader requests `techdocs-backend` plugin for the docs site.
`techdocs-backend` then requests your configured storage solution for the necessary files and returns them to TechDocs
Reader.

Depending on your chosen cloud storage provider and its real-world proximity to your backend server, there may be a
comparably high amount of latency when loading TechDocs sites using this deployment approach. If you encounter this,
you can optionally configure the `techdocs-backend` to cache responses in a
cache store [supported by Backstage](../../overview/architecture-overview.md#cache).

### Security

Our biggest security concern is managing the access to the docs in the cloud storage. We also want to have only one
security solution for all different types of storage (GCS, AWS, custom SFTP server, etc.) Restricting access to the
storage and only allowing `techdocs-backend` to fetch files is a good way to achieve this.

This would also allow us to use the access control management Backstage when that is ready.
[Track progress here.](https://github.com/backstage/backstage/issues/3218)

In theory, you can directly enable TechDocs Reader to read from your storage. But, you will have to think about how to
do it without the docs being public and how access to user groups is managed.

For cloud storage access tokens, `techdocs-backend` only needs a token with Read permissions. But in your CI/CD system,
there needs to be a token with Write permissions to publish the generated docs site files.
